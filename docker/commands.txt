################### Create Process ######################################
# Login to your account (Provide user & token)
docker login
# Build docker from Dockerfile
docker build -t ubuntu-mysql-client .
# Push created Container to my repository
# docker tag akpysec/mysql-client akpysec/mysql-client:latest
docker push akpysec/ubuntu-mysql-cli

################### Running in the EKS Cluster ###########################
# Check Cluster Information
kubectl cluster-info
# View running Nodes
kubectl get nodes
# Pull docker
docker pull akpysec/ubuntu-mysql-cli

# Set up kubectl and IAM authenticator
# IAM Athenticator https://docs.aws.amazon.com/eks/latest/userguide/install-aws-iam-authenticator.html
# Kubectl https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html

# copy terraform kubeconfig output to kubeconfig
touch /home/ec2-user/.kube/config
terraform output kubeconfig | tail -n +2 | head -c -5 > /home/ec2-user/.kube/config

# Check EKS version
eksctl version

# Creating App
kubectl create deployment mysql-cli --image=akpysec/ubuntu-mysql-cli
# View Deployment and running Pods
kubectl get deployment -o wide
kubectl get pods -o wide
