################### Create Docker Image & Push to Public Repository ######################################

# Login to your account (Provide user & token)
docker login
# Build docker from Dockerfile
docker build -t ubuntu-mysql-client .
# Push created Container to my repository
# docker tag akpysec/mysql-client akpysec/mysql-client:latest
docker push akpysec/ubuntu-mysql-cli

############################### Running in the EKS Cluster ###############################################

# Prerequisites:
# Set up kubectl and IAM authenticator
# IAM Athenticator https://docs.aws.amazon.com/eks/latest/userguide/install-aws-iam-authenticator.html
# Kubectl https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html

# Check Kubernetes version
kubectl version

# Check Cluster Information
kubectl cluster-info

# copy terraform kubeconfig output to kubeconfig
touch /home/ec2-user/.kube/config
terraform output kubeconfig | tail -n +2 | head -c -5 > /home/ec2-user/.kube/config

# Connecting to MySQL DB
kubectl run -it --rm --image=akpysec/ubuntu-mysql-cli:latest --restart=Never mysql-client -- mysql --host=<specify_db_endpoint> --user=<specify_username> --password=<spicify_password>

